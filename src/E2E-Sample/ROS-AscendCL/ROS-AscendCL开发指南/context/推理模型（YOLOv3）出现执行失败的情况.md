# 推理模型（YOLOv3）出现执行失败的情况<a name="ZH-CN_TOPIC_0000001587790621"></a>

## 问题描述<a name="section13793123154311"></a>

未按照[目标检测样例教程](编译和运行.md#li9677232372)中的步骤准备yolov3.om离线模型，直接在[华为ModelZoo网站](https://www.hiascend.com/software/modelzoo)或者其他地方下载了相似的Caffe YOLOv3模型，然后通过ATC工具转换为离线模型文件。此类场景大概率会出现模型执行失败的情况，部分失败代码如下所示：

```
[inference_node-1] aclError ret =145000 // 打印错误代码
[inference_node-1] [ERROR]   execute model failed, modelId is 1
```

## 可能的原因<a name="section1877432274411"></a>

-   模型要求的输入大小和准备的数据size不匹配导致。
-   模型输入的图像格式不一样，有的是单通道YUV图像格式，有的是3通道BGR图像格式，如果在数据预处理阶段未对推理模型进行对应的输入格式规范，就会造成模型执行失败。

## 处理方案<a name="section18171811165610"></a>

1.  检查当前使用的yolov3.om模型内部与样例提供的模型是否一致。主要检查输入图像格式和大小、输出图像格式和大小和数据结构。
    -   如果检查结果一致，问题解决，基本可以正常使用。
    -   如果检查结果不一致，问题未解决，请执行[步骤2](#li53481733192720)。

2.  根据当前使用的yolov3.om模型结构，分别修改数据预处理、后处理阶段的代码逻辑，适配模型的输入和输出格式、大小等。
    1.  数据预处理阶段：先修改“[目标检测样例API \> CreateInput](CreateInput.md)”接口，设置正确的模型输入数据格式和大小。
    2.  数据后处理阶段：再修改“[目标检测样例API \> Postprocess](Postprocess.md)”接口，设置正确的模型输出数据格式和大小。
    3.  重新编译代码并运行。


